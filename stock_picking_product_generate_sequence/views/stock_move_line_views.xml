<odoo>
    <record id='view_stock_move_line_detailed_operation_tree' model='ir.ui.view'>
        <field name='name'>stock.move.line.view.tree</field>
        <field name='model'>stock.move.line</field>
        <field name='inherit_id' ref='stock.view_stock_move_line_detailed_operation_tree'/>
        <field name='arch' type='xml'>
            <field name='lot_id' position='after'>
                <field name="picking_code" invisible="1"/>
                <button name='action_generate_product_serial'
                        type='object'
                        class='btn btn-primary fa fa-plus-square-o'
                        title='Creates a new serial/lot number'
                        groups='stock.group_production_lot'
                        attrs='{
                            "column_invisible": [("parent.show_lots_text", "=", True)],
                            "invisible": [
                                "|",
                                "|",
                                "|",
                                ("lots_visible", "=", False),
                                ("lot_id", "!=", False),
                                ("picking_code", "!=", "incoming"),
                                ("state", "not in", ["draft", "assigned", "waiting", "partially_available"])
                                ]
                            }'
                />
            </field>
        </field>
    </record>
</odoo>
